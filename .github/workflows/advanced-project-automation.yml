name: Advanced Project Automation

on:
  issues:
    types: [opened, labeled, unlabeled, assigned]
  issue_comment:
    types: [created]

jobs:
  auto-triage:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const comment = context.payload.comment;
            
            // Auto-assign based on component labels
            const componentAssignments = {
              'component:backend': 'ApacheEcho',
              'component:frontend': 'frontend-dev',
              'component:api': 'api-team'
            };
            
            // Check for blocking issues
            if (comment && comment.body.includes('blocked by #')) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: ['blocked']
              });
            }
            
            // Auto-prioritize based on keywords
            if (issue.title.toLowerCase().includes('critical') || 
                issue.title.toLowerCase().includes('urgent')) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: ['high-priority']
              });
            }
            
            // Add automation for project management
            if (issue.title.toLowerCase().includes('bug') || 
                issue.title.toLowerCase().includes('fix')) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: ['bug', 'needs-investigation']
              });
            }
            
            // Feature requests automation
            if (issue.title.toLowerCase().includes('feature') || 
                issue.title.toLowerCase().includes('enhancement')) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: ['enhancement', 'feature-request']
              });
            }
            
            // Automation setup tasks
            if (issue.title.toLowerCase().includes('automation') || 
                issue.title.toLowerCase().includes('setup') ||
                issue.title.toLowerCase().includes('configure')) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: ['automation', 'configuration']
              });
            }
